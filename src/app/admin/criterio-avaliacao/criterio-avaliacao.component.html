<div class="container">
  <div class="row justify-content-between">
    <div class="section-header" mat-dialog-title>
      <h2>Critério de Avaliação</h2>
    </div>
  </div>
  <div class="row justify-content-end mb-5">
    <div class="col-auto">
      <button type="button" (click)="toggleEditar(!flagEdit)" mat-raised-button color="primary"
        [ngStyle]="{'background-color': !flagEdit ? 'green' : ''}">
        {{flagEdit ? 'Voltar' : 'Adicionar novo'}}
      </button>

    </div>
  </div>
  
  <form *ngIf="flagEdit; else elseEdit" [formGroup]="form" class="reviewer container mb-5" (ngSubmit)="onSubmit()">
  
    <div class="form-row justify-content-center">
        <div class="form-group col-md-12">
          <h4>Título do critério <span style="color: #7a7a7a;">(não será exibido para os usuários)</span></h4>
          <input type="text" class="form-control" placeholder="Título do critério" formControlName="title" />
        </div>
    </div>
  
    <div formArrayName="step">
  
      <div *ngFor="let stepLine of getFormStep.controls; let i = index;" class="row mb-3">
        <h1>Etapa {{i+1}} </h1>
  
        <div class="col-12 justify-content-center border border-dark p-3" [formGroupName]="i">
  
          <div class="row mb-3">
            <h4>Título da etapa:</h4>
            <input type="text" class="form-control" placeholder="Titulo da etapa" formControlName="title" />
          </div>
          <div formArrayName="section" >
            <div *ngFor="let sectionLine of getFormSection(i).controls; let j = index;" class="row p-0 align-items-center">
              <div class="col">
                <div class="row justify-content-center align-items-center text-start border border-dark mb-3 py-3" [formGroupName]="j">
                  <div class="col-md-3 mb-3">
                    <h4>Título da seção:</h4>
                    <textarea matInput class="form-control" placeholder="Titulo da seção" formControlName="title" ></textarea>
                  </div>
    
                  
                  <div formArrayName="question" class="col-md-9">
                    <div class="row">
                      <div class="row">
                        <div class="col-9">
                          <h4>Critério:</h4>
                        </div>
                        <div class="col-3">
                          <h4>Nota máxima:</h4>
                        </div>
                      </div>
                    </div>
                    <div *ngFor="let questionLine of getFormQuestion(i, j).controls; let k = index;" class="row">
                      <div class="row mb-3 justify-content-center" [formGroupName]="k">
                        <div class="col-9">
                          <input type="text" class="form-control" placeholder="Critério" formControlName="text" />
                        </div>
                        <div class="col-2">
                          <input (keypress)="validateNumber($event)" type="text" class="form-control" placeholder="Nota máxima para o critério" formControlName="maxNota" />
                        </div>
                        <div class="col-1">
                          <button mat-icon-button color="warn" type="button" (click)="removeQuestionLine(i, j, k)"><mat-icon>delete</mat-icon></button>
                        </div>
    
                      </div>
                    </div>
                  </div>
                  <div class="row justify-content-end">
                    <div class="col-auto">
                      <button mat-raised-button type="button" class="mt-3 add-button" (click)="addQuestionLine(null, i, j)">Incluir critério</button>
                    </div>
                  </div>
    
                </div>
              </div>
              <div class="col-auto p-0">
                <button mat-icon-button color="warn" type="button" (click)="removeSectionLine(i, j)"><mat-icon>delete</mat-icon></button>
              </div>
            </div>
          </div>
          <div class="row justify-content-end">
            <div class="col-auto">
              <button mat-raised-button type="button" class="mt-3 add-button" (click)="addSectionline(null, i)">Incluir seção</button>
            </div>
          </div>
  
        </div>
        <div class="row justify-content-end">
          <div class="col-auto">
            <button mat-raised-button color="warn" type="button" class="mt-3" (click)="removeStepLine(i)">Remover Etapa</button>
          </div>
        </div>
      </div>
    </div>
    <div class="row justify-content-end">
      <div class="col-auto">
        <button mat-raised-button type="button" class="mt-3 add-button" (click)="addStepLine()">Incluir Etapa</button>
      </div>
    </div>
    <button mat-raised-button color="primary" class="w-100 mt-5">SALVAR</button>
  </form>
  
  <ng-template #elseEdit class="row text-center" data-aos-delay="200">
    <div class="card-body">
        <div class="text-center">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Título</th>
                        <th scope="col">Quantidade de etapas</th>
                        <th scope="col">Atualizado em:</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody>

                    <tr *ngFor="let criterio of listCriterio; let i= index">
                      <th scope="row">{{ criterio.title }}</th>
                      <th scope="row">{{ criterio.step?.length }}</th>
                      <th scope="row">{{ criterio.updatedAt | date: 'dd/MM/yyyy HH:mm:ss' }}</th>
                      <th scope="row">
                        <span matTooltip="Excluir" matTooltipPosition="above"
                          class="material-icons md-18 btn" (click)="deleteById(criterio._id, criterio.title)">delete</span>
                        <span matTooltip="Editar" matTooltipPosition="above"
                          class="material-icons md-18 btn" (click)="toggleEditar(true, criterio)">edit_square</span>
                      </th>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
  </ng-template>
</div>

<div class="container">

</div>
